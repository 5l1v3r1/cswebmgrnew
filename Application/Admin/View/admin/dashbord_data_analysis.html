<extend name="public/template" />
<block name="headerlink">
	<!-- BEGIN PAGE LEVEL PLUGIN STYLES -->
	<link href="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css"/>
	<link href="__PUBLIC__/metronic3_7/assets/global/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" type="text/css"/>
	<link href="__PUBLIC__/metronic3_7/assets/global/plugins/jqvmap/jqvmap/jqvmap.css" rel="stylesheet" type="text/css"/>
	<!-- END PAGE LEVEL PLUGIN STYLES -->
	<!-- BEGIN PAGE STYLES -->
	<link href="__PUBLIC__/metronic3_7/assets/admin/pages/css/tasks.css" rel="stylesheet" type="text/css"/>
	<!-- END PAGE STYLES -->
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/tooltip.js"></script>
	<!-- <link href="__PUBLIC__/metronic3_7/assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/> -->
	<style type="text/css">
svg {
    font-family: Sans-Serif, Arial;
}
.line {
  stroke-width: 2;
  fill: none;
}

.axis path {
  stroke: black;
}
.text {
  font-size: 12px;
}

.title-text {
  font-size: 12px;
}
div.tooltip {
  position: absolute;
  text-align: center;
  width: 150px;
  height: 28px;
  padding: 2px;
  font: 12px sans-serif;
  background: lightsteelblue;
  border: 0px;
  border-radius: 8px;
  pointer-events: none;
}
</style>
</block>
<block name="siderbarmenu">
	<ul class="page-sidebar-menu " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
		<!-- DOC: To remove the sidebar toggler from the sidebar you just need to completely remove the below "sidebar-toggler-wrapper" LI element -->
		<li class="sidebar-toggler-wrapper">
			<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
			<div class="sidebar-toggler">
			</div>
			<!-- END SIDEBAR TOGGLER BUTTON -->
		</li>
		<!-- DOC: To remove the search box from the sidebar you just need to completely remove the below "sidebar-search-wrapper" LI element -->
		<li class="sidebar-search-wrapper">
			<!-- BEGIN RESPONSIVE QUICK SEARCH FORM -->
			<!-- DOC: Apply "sidebar-search-bordered" class the below search form to have bordered search box -->
			<!-- DOC: Apply "sidebar-search-bordered sidebar-search-solid" class the below search form to have bordered & solid search box -->
			<form class="sidebar-search " action="extra_search.html" method="POST">
				<a href="javascript:;" class="remove">
				<i class="icon-close"></i>
				</a>
				<div class="input-group">
					<input type="text" class="form-control" placeholder="Search..." />
					<span class="input-group-btn">
					<a href="javascript:;" class="btn submit"><i class="icon-magnifier"></i></a>
					</span>
				</div>
			</form>
			<!-- END RESPONSIVE QUICK SEARCH FORM -->
		</li>
		<li class="start active open">
			<a href="javascript:;">
			<i class="icon-home"></i>
			<span class="title">Dashboard</span>
			<span class="selected"></span>
			<span class="arrow open"></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Dashboard/index');}">
					<i class="icon-bar-chart"></i>
					Default Dashboard</a>
				</li>
				<li class="active">
					<a href="{:U('Dashboard/showDataAnalysis');}">
					<i class="icon-bar-chart"></i>
					Data Analysis</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-basket"></i>
			<span class="title">eCommerce</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="ecommerce_index.html">
					<i class="icon-home"></i>
					Dashboard</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=2');}">
					<i class="icon-bell"></i>
					<span class="badge badge-danger">{$cin}</span>
					Orders Ongoing</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=4');}">
					<i class="fa fa-warning"></i>
					<span class="badge badge-danger">{$cin1}</span>
					<font color="red">Orders Warning</font></a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=1');}">
					<i class="fa fa-lock"></i>
					Complete Orders</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=3');}">
					<i class="icon-basket"></i>
					Orders All</a>
				</li>
				<li>
					<a href="#">
						<i class="icon-bar-chart"></i>
						Data Analysis
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
				<i class="fa fa-code"></i>
				<span class="title">Workers</span>
				<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="ecommerce_index.html">
					<i class="icon-home"></i>
					Dashboard</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist');}">
						<i class="icon-basket"></i>
						ALL Workers Workers
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=4');}">
						<i class="icon-basket"></i>
						free workers
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=5');}">
						<i class="icon-basket"></i>
						busy workers
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=2');}">
						<i class="icon-basket"></i>
						Income > 0
					</a>
				</li>
				<li >
					<a href="{:U('Worker/workerlist?type=1');}">
						<i class="icon-basket"></i>
						Income = 0
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=3');}">
						<i class="icon-basket"></i>
						dead workers
					</a>
				</li>
				<li>
					<a href="#">
						<i class="icon-bar-chart"></i>
						Data Analysis
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="fa fa-wrench" aria-hidden="true"></i>
			<span class="title">Tools</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Tool/exchangeToolPage');}">
						<i class="fa fa-usd" aria-hidden="true"></i> Exchange Transfer Tool
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-settings"></i>
			<span class="title">Configuration</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Configure/exchangelist');}">
						Exchange Rate
					</a>
				</li>
				<li>
					<a href="{:U('Configure/techlist');}">
						Technologies Conf
					</a>
				</li>
				<li>
					<a href="{:U('Configure/tradelist');}">
						Trade Conf
					</a>
				</li>

			</ul>
		</li>

	</ul>
</block>
<block name="container">
	<div class="page-content">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- BEGIN STYLE CUSTOMIZER -->
			<!-- END STYLE CUSTOMIZER -->
			<!-- BEGIN PAGE HEADER-->
			<div class="page-bar">
				<ul class="page-breadcrumb">
					<li>
						<i class="fa fa-home"></i>
						<a href="{:U('Dashboard/index');}">Home</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="#">Dashboard</a>
					</li>
				</ul>
			</div>
			<h3 class="page-title">
			Dashboard <small>reports & statistics</small>
			</h3>
			<!-- END PAGE HEADER-->
			<!-- BEGIN DASHBOARD STATS -->
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat blue-madison">
						<div class="visual">
							<i class="fa fa-comments"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$revenues} <i class="fa fa-cny"></i>
							</div>
							<div class="desc">
								 Revenues/total
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat red-intense">
						<div class="visual">
							<i class="fa fa-bar-chart-o"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$profit} <i class="fa fa-cny"></i>
							</div>
							<div class="desc">
								 Profit/total
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat green-haze">
						<div class="visual">
							<i class="fa fa-shopping-cart"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$cin}
							</div>
							<div class="desc">
								 Ongoing
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat purple-plum">
						<div class="visual">
							<i class="fa fa-globe"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$ongoingprofit}<i class="fa fa-cny"></i>
							</div>
							<div class="desc">
								 Estimat
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
			</div>
			<!-- END DASHBOARD STATS -->
			<div class="clearfix"></div>
			<div class="row">
				<div class="col-md-6 col-sm-6" style="height: 570px;">
				<!-- BEGIN PORTLET-->
					<div class="portlet light ">
						<div class="portlet-title">
							<div class="caption">
								<i class="icon-bar-chart font-green-sharp hide"></i>
								<span class="caption-subject font-green-sharp bold uppercase">Global statistic</span>
								<span class="caption-helper">global statistic...</span>
							</div>
						</div>
						<div class="portlet-body" >
							<div class="portlet-body">
								<div class="row static-info">
									<div class="col-md-6 name">
										 Revenues (all completed):
									</div>
									<div class="col-md-6 value">
										 <i class="fa fa-paper-plane"></i> {$revenues} RMB
									</div>
								</div>
								<foreach name="revenuesarr" item="vo">
									<div class="row static-info">
										<div class="col-md-6 name">
										</div>
										<div class="col-md-6 value">
											 <small><i class="fa fa-check-square-o"></i> {$vo['revenues']} {$vo['moneytype']} </small><span class="label label-sm label-info"> {$vo['rating']} </span>
										</div>
									</div>
								</foreach>
								<div class="row static-info">
									<div class="col-md-6 name">
										 Profit (all completed):
									</div>
									<div class="col-md-6 value">
										 <i class="fa fa-paper-plane"></i> {$profit} RMB
									</div>
								</div>
								<div class="row static-info">
									<div class="col-md-6 name">
										 Worker Salary (all completed):
									</div>
									<div class="col-md-6 value">
										 <i class="fa fa-paper-plane"></i> {$salary} RMB
									</div>
								</div>
								<div class="row static-info">
									<div class="col-md-6 name">
										 No. completed Orders
									</div>
									<div class="col-md-6 value">
										 <i class="fa fa-paper-plane"></i> {$ordernum}
									</div>
								</div>
								<div class="row static-info">
									<div class="col-md-6 name">
										 Average Profig/day (all completed):
									</div>
									<div class="col-md-6 value">
										 <i class="fa fa-paper-plane"></i> {$profitavg} RMB
									</div>
								</div>
								<hr/>
								<div class="row static-info">
									<div class="col-md-3 name">
										 Revenues (ongoing):
									</div>
									<div class="col-md-3 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingrevenues} RMB
									</div>
									<div class="col-md-4 name">
										 Order Unpaid && done:
									</div>
									<div class="col-md-2 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingunpaid}
									</div>
								</div>

								<div class="row static-info">
									<div class="col-md-3 name">
									</div>
									<div class="col-md-3 value">
										<foreach name="ongoingrevenuesarr" item="vo">
										 <small><i class="fa fa-check-square-o"></i> {$vo['revenues']} {$vo['moneytype']} <br/></small>
										</foreach>
									</div>
									<div class="col-md-4 name">
										 Order Doing:
									</div>
									<div class="col-md-2 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingdoing}
									</div>
								</div>

								<div class="row static-info">
									<div class="col-md-3 name">
										 Profit (ongoing):
									</div>
									<div class="col-md-3 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingprofit} RMB
									</div>
									<div class="col-md-4 name">
										Order Unset:
									</div>
									<div class="col-md-2 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingunset}
									</div>
								</div>
								<div class="row static-info">
									<div class="col-md-3 name">
										 Salary (ongoing):
									</div>
									<div class="col-md-3 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingsalary} RMB
									</div>
								</div>
								<div class="row static-info">
									<div class="col-md-3 name">
										 No.Orders(ongoing):
									</div>
									<div class="col-md-3 value">
										 <i class="fa fa-paper-plane"></i> {$cin}
									</div>
								</div>
								<hr/>
							</div>
						</div>
					</div>
				<!-- END PORTLET-->
			</div>
				<div class="col-md-6 col-sm-12">
						<div class="portlet box green">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-gift"></i> Days of every Month statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form">
								<div class="row">

									<div id="daychart" style="padding: 0px; position: relative;width:100%;height: 550px;"></div>
								</div>

							</div>
						</div>
				</div>
				<div class="col-md-6 col-sm-12">
						<div class="portlet box green">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-gift"></i> Months of every Year statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form">
								<div class="row">

									<div id="monthchart" style="padding: 0px; position: relative;width:100%;height: 550px;"></div>
								</div>

							</div>
						</div>
				</div>
				<div class="col-md-6 col-sm-12">
						<div class="portlet box green">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-gift"></i> Months of every Year statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form">
								<div class="row">

									<div id="monthchart" style="padding: 0px; position: relative;width:100%;height: 550px;"></div>
								</div>

							</div>
						</div>
				</div>
				<div class="col-md-12 col-sm-12">
						<div class="portlet box green">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-gift"></i> Years statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form">
								<div class="row">

									<div id="chart" style="padding: 0px; position: relative;width:100%;height: 500px;"></div>
								</div>

							</div>
						</div>
				</div>

			</div>
			<div class="clearfix">
			</div>
		</div>
</block>
<block name="footscript">
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/select2/select2.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/datatables/media/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL SCRIPTS -->
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/clockface/js/clockface.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL SCRIPTS -->
	<script src="__PUBLIC__/metronic3_7/assets/global/scripts/metronic.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/pages/scripts/components-pickers.js"></script>
	<script src="__PUBLIC__/metronic3_7/assets/global/scripts/metronic.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/pages/scripts/components-pickers.js"></script>
	<script src="__PUBLIC__/data.formate.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js'></script>

	<!-- END PAGE LEVEL SCRIPTS -->
	<script>
		jQuery(document).ready(function() {
			// initiate layout and plugins
			Metronic.init(); // init metronic core components
			Layout.init(); // init current layout
			Demo.init(); // init demo features
			ComponentsPickers.init();
        });
		get_daytoday_query("0","0");
		function get_daytoday_query(fromdate,todate){
			var data = {};
			data.fromdate = fromdate;
			data.todate = todate;
			var url='__URL__/getDayToDay';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {
					  //showstorelist(data.stores);
						var para = {mindate:new Date('1900-01-01'),maxdate:new Date('1900-12-31'),xtformate:"%m"};
						drawLineChart(data,"#chart","profit",para);

				}
			});
		}
		get_each_query("0","0");
		function get_each_query(fromdate,todate){
			var data = {};
			data.fromdate = fromdate;
			data.todate = todate;
			var url='__URL__/getEachMonth';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {

						para = {mindate:new Date('1900-01-01'),maxdate:new Date('1900-01-31'),xtformate:"%d"};
						drawLineChart(data,"#daychart","profit",para)	;

				}
			});
		}
	//drawLineChart(data,"#chart","price");
		function drawLineChart(data,chartid,attrname,para){
			var div = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);

			var wd = $(chartid).width();
			var wh = $(chartid).height();
			var margin = {top:20, left:60, bottom:10, right:20};
			var height = wh - margin.top - margin.bottom,
					width = wd - margin.left - margin.right;
			console.log(width);
			var duration = 50;

			var lineOpacity = "0.25";
			var lineOpacityHover = "0.85";
			var otherLinesOpacityHover = "0.1";
			var lineStroke = "1.5px";
			var lineStrokeHover = "2.5px";

			var circleOpacity = '0.85';
			var circleOpacityOnLineHover = "0.25"
			var circleRadius = 2;
			var circleRadiusHover = 6;


			/* Format Data */
			var parseDate = d3.timeParse("%m-%d");
			data.forEach(function(d) {
			  d.values.forEach(function(d) {
				d.createday = parseDate(d.createday);
				d[attrname] = +d[attrname];
			  });
			});


			/* Scale */
		    var mindate = para.mindate;
		    var maxdate = para.maxdate;
			var xScale = d3.scaleTime()
			  .domain([mindate,maxdate])
			  .range([0, width-margin.left-margin.right]);
			//console.log(d3.extent(data[0].values, d => d.createday));
			var yScale = d3.scaleLinear()
			  .domain([0, d3.max(data[0].values, d => d[attrname])])
			  .range([height-margin.top - margin.bottom, 0]);

			var color = d3.scaleOrdinal(d3.schemeCategory10);

			/* Add SVG */
			var svg = d3.select(chartid).append("svg")
			  .attr("width", (width + margin.left + margin.right)+"px")
			  .attr("height", (height+margin.top + margin.bottom)+"px")
			  .append('g')
			  .attr("transform", `translate(${margin.left}, ${margin.right})`);


			/* Add line into SVG */
			var line = d3.line()
			  .x(d => xScale(d.createday))
			  .y(d => yScale(d[attrname]))
              .curve(d3.curveCardinal);

			let lines = svg.append('g')
			  .attr('class', 'lines');

			lines.selectAll('.line-group')
			  .data(data).enter()
			  .append('g')
			  .attr('class', 'line-group')

			  .append('path')
			  .attr('class', 'line')
			  .attr('d', d => line(d.values))
			  .style('stroke', (d, i) => color(i))
			  .style('opacity', lineOpacity)
			  ;


			/* Add circles in the line */
			lines.selectAll("circle-group")
			  .data(data).enter()
			  .append("g")
			  .style("fill", (d, i) => color(i))
			  .selectAll("circle")
			  .data(d => d.values).enter()
			  .append("g")
			  .attr("class", "circle")
				.on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   	  div.html(d.fullcreateday+ "<br/>" +attrname + ":" +  d[attrname])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY - 28) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   })
			  .append("circle")
			  .attr("cx", d => xScale(d.createday))
			  .attr("cy", d => yScale(d[attrname]))
			  .attr("r", circleRadius)
			  .style('opacity', circleOpacity)
			  ;


			/* Add Axis into SVG */
			var xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat(para.xtformate));

			var yAxis = d3.axisLeft(yScale).ticks(5);

			svg.append("g")
			  .attr("class", "x axis")
			  .attr("transform", `translate(0, ${height-margin.top-margin.bottom})`)
			  .call(xAxis);

			svg.append("g")
			  .attr("class", "y axis")
			  .call(yAxis)
			  .append('text')
			  .attr("y", 15)
			  .attr("transform", "rotate(-90)")
			  .attr("fill", "#000")
			  .text("Total values");

		}
		get_each_month_query("0","0");
		function get_each_month_query(fromdate,todate){
			var data = {};
			data.fromdate = fromdate;
			data.todate = todate;
			var url='__URL__/getMonths';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {

						//para = {mindate:new Date('1900-01-01'),maxdate:new Date('1900-01-31'),xtformate:"%d"};
						//drawLineChart(data,"#daychart","profit",para)	;
						var para = {data}
						drawMultiBarChart("#monthchart",para,"month");

				}
			});
		}
		//drawMultiBarChart("#monthchart",para);
		function drawMultiBarChart(chartname,para,kname){
			const data = para.data;
			console.log(data);
		const keys = Object.keys(data[0]);
		if(keys.indexOf("month")>=0){
			keys.splice(keys.indexOf(kname), 1);
		}
		console.log(keys);
		const tip = d3.tip().html(d=> d.key+ ": "+d.value);

		var wd = $(chartname).width();
			var wh = $(chartname).height();
			var margin = {top:20, left:60, bottom:70, right:20};
			var height = wh - margin.top - margin.bottom,
			    width = wd - margin.left - margin.right;
		  $(chartname).html("");
			var svg = d3.select(chartname)
			        .append("svg")
			        .attr("height", height + margin.top + margin.bottom)
			        .attr("width", width + margin.left + margin.right)
			        .style("cursor","default");
			 var g = svg.append("g")
			        .attr("transform","translate(" + margin.left + "," + margin.top + ")");

		svg.call(tip)

		const x0 = d3.scaleBand()
		  .rangeRound([0, width])
		  .paddingInner(.1);

		const x1 = d3.scaleBand()
		  .padding(.05);

		const y = d3.scaleLinear()
		  .rangeRound([height, 0]);

		const z =  d3.scaleOrdinal(d3.schemeCategory10);

		  x0.domain(data.map(d => d[kname]));
		  x1.domain(keys).rangeRound([0, x0.bandwidth()]);
		  y.domain([0, d3.max(data, d => d3.max(keys, key=> d[key]))]).nice();
		//console.log(d3.max(data, d => d3.max(keys, key=> d[key])));
		g.append('g')
		  .selectAll('g')
		  .data(data)
		  .enter()
		  .append('g')
		  .attr('transform', d => 'translate(' + x0(d[kname]) + ',0)')
		  .selectAll('rect')
		  .data(d => keys.map(key => {return {key: key, value: d[key]}}))
		  .enter().append('rect')
		  .attr('x', d => x1(d.key))
		  .attr('y', d => y(d.value))
		  .attr('width', x1.bandwidth()+1)
		  .attr('height', d => height - y(d.value))
		  .attr('fill', d =>  z(d.key))
		  .on('mouseover', tip.show)
		  .on('mouseout', tip.hide)

		g.append('g')
		  .attr('class', 'axis-bottom')
		  .attr('transform', 'translate(0,' + height + ')')
		  .call(d3.axisBottom(x0));

		g.append('g')
		  .attr('class', 'axis-left')
		  .call(d3.axisLeft(y).ticks(null, 's'))
		  .append('text')
		  .attr('x', 10)
		  .attr('y', y(y.ticks().pop()) + 10)
		  .attr('dy', '0.32em')
		  .attr('fill', '#000')
		  .style('transform', 'rotate(-90deg)')
		  .attr('font-weight', 'bold')
		  .attr('text-anchor', 'end')
		  .text('Population');

		const legend = g.append('g')
		   .attr('font-family', 'sans-serif')
		   .attr('font-size', 10)
		   .attr('text-anchor', 'end')
		   .selectAll('g')
		   .data(keys.slice().reverse())
		   .enter().append('g')
		   .attr('transform', (d, i) => 'translate(0,' + i * 20 + ')');

		legend.append('rect')
		  .attr('x', width - 19)
		  .attr('width', 10)
		  .attr('height', 10)
		  .attr('fill', z);

		legend.append('text')
		  .attr('x', width - 32)
		  .attr('y', 6)
		  .attr('dy', '0.32em')
		  .text(d => d);
				}




		</script>
</block>
